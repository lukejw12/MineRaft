execute anchored eyes positioned ^ ^ ^ run function mineraft:ui/water_purifier/start_raycast
execute unless entity @e[tag=ui_target_water_purifier] run return 0

execute as @e[type=marker,tag=water_purifier_active,sort=nearest,limit=1,distance=..3] run tag @s add ui_water_purifier

execute as @e[type=marker,tag=ui_water_purifier,limit=1] run scoreboard players operation #temp_has_water dummy = @s has_water
execute as @e[type=marker,tag=ui_water_purifier,limit=1] run scoreboard players operation #temp_has_planks dummy = @s has_planks
execute as @e[type=marker,tag=ui_water_purifier,limit=1] run scoreboard players operation #temp_processing dummy = @s processing
execute as @e[type=marker,tag=ui_water_purifier,limit=1] run scoreboard players operation #temp_ready dummy = @s ready

execute as @e[type=marker,tag=ui_water_purifier,limit=1] if entity @s[tag=processing,tag=!ready] run function mineraft:ui/water_purifier/calculate_countdown

execute if score #temp_has_water dummy matches 0 if score #temp_has_planks dummy matches 0 if score #current weather.state matches 0 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Materials: ","color":"gray"},{"text":"Water","color":"red"},{"text":" / ","color":"gray"},{"text":"Planks","color":"red', hydration_color:"red", weather_name:"Clear Skies", weather_color:"aqua"}
execute if score #temp_has_water dummy matches 0 if score #temp_has_planks dummy matches 0 if score #current weather.state matches 1 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Materials: ","color":"gray"},{"text":"Water","color":"red"},{"text":" / ","color":"gray"},{"text":"Planks","color":"red', hydration_color:"red", weather_name:"Light Breeze", weather_color:"blue"}
execute if score #temp_has_water dummy matches 0 if score #temp_has_planks dummy matches 0 if score #current weather.state matches 2 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Materials: ","color":"gray"},{"text":"Water","color":"red"},{"text":" / ","color":"gray"},{"text":"Planks","color":"red', hydration_color:"red", weather_name:"Storm", weather_color:"yellow"}
execute if score #temp_has_water dummy matches 0 if score #temp_has_planks dummy matches 0 if score #current weather.state matches 3 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Materials: ","color":"gray"},{"text":"Water","color":"red"},{"text":" / ","color":"gray"},{"text":"Planks","color":"red', hydration_color:"red", weather_name:"Heavy Storm", weather_color:"gold"}

execute if score #temp_has_water dummy matches 1 if score #temp_has_planks dummy matches 0 if score #current weather.state matches 0 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Materials: ","color":"gray"},{"text":"Water","color":"green"},{"text":" / ","color":"gray"},{"text":"Planks","color":"red', hydration_color:"red", weather_name:"Clear Skies", weather_color:"aqua"}
execute if score #temp_has_water dummy matches 1 if score #temp_has_planks dummy matches 0 if score #current weather.state matches 1 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Materials: ","color":"gray"},{"text":"Water","color":"green"},{"text":" / ","color":"gray"},{"text":"Planks","color":"red', hydration_color:"red", weather_name:"Light Breeze", weather_color:"blue"}
execute if score #temp_has_water dummy matches 1 if score #temp_has_planks dummy matches 0 if score #current weather.state matches 2 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Materials: ","color":"gray"},{"text":"Water","color":"green"},{"text":" / ","color":"gray"},{"text":"Planks","color":"red', hydration_color:"red", weather_name:"Storm", weather_color:"yellow"}
execute if score #temp_has_water dummy matches 1 if score #temp_has_planks dummy matches 0 if score #current weather.state matches 3 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Materials: ","color":"gray"},{"text":"Water","color":"green"},{"text":" / ","color":"gray"},{"text":"Planks","color":"red', hydration_color:"red", weather_name:"Heavy Storm", weather_color:"gold"}

execute if score #temp_has_water dummy matches 0 if score #temp_has_planks dummy matches 1 if score #current weather.state matches 0 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Materials: ","color":"gray"},{"text":"Water","color":"red"},{"text":" / ","color":"gray"},{"text":"Planks","color":"green', hydration_color:"red", weather_name:"Clear Skies", weather_color:"aqua"}
execute if score #temp_has_water dummy matches 0 if score #temp_has_planks dummy matches 1 if score #current weather.state matches 1 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Materials: ","color":"gray"},{"text":"Water","color":"red"},{"text":" / ","color":"gray"},{"text":"Planks","color":"green', hydration_color:"red", weather_name:"Light Breeze", weather_color:"blue"}
execute if score #temp_has_water dummy matches 0 if score #temp_has_planks dummy matches 1 if score #current weather.state matches 2 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Materials: ","color":"gray"},{"text":"Water","color":"red"},{"text":" / ","color":"gray"},{"text":"Planks","color":"green', hydration_color:"red", weather_name:"Storm", weather_color:"yellow"}
execute if score #temp_has_water dummy matches 0 if score #temp_has_planks dummy matches 1 if score #current weather.state matches 3 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Materials: ","color":"gray"},{"text":"Water","color":"red"},{"text":" / ","color":"gray"},{"text":"Planks","color":"green', hydration_color:"red", weather_name:"Heavy Storm", weather_color:"gold"}

execute if score #temp_has_water dummy matches 1 if score #temp_has_planks dummy matches 1 if score #temp_processing dummy matches 1 if score #temp_ready dummy matches 0 if score #current weather.state matches 0 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Processing: ","color":"yellow"},{"score":{"name":"#minutes","objective":"dummy"},"color":"yellow"},{"text":":","color":"yellow"},{"score":{"name":"#seconds","objective":"dummy"},"color":"yellow"},{"text":"","color":"yellow', hydration_color:"red", weather_name:"Clear Skies", weather_color:"aqua"}
execute if score #temp_has_water dummy matches 1 if score #temp_has_planks dummy matches 1 if score #temp_processing dummy matches 1 if score #temp_ready dummy matches 0 if score #current weather.state matches 1 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Processing: ","color":"yellow"},{"score":{"name":"#minutes","objective":"dummy"},"color":"yellow"},{"text":":","color":"yellow"},{"score":{"name":"#seconds","objective":"dummy"},"color":"yellow"},{"text":"","color":"yellow', hydration_color:"red", weather_name:"Light Breeze", weather_color:"blue"}
execute if score #temp_has_water dummy matches 1 if score #temp_has_planks dummy matches 1 if score #temp_processing dummy matches 1 if score #temp_ready dummy matches 0 if score #current weather.state matches 2 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Processing: ","color":"yellow"},{"score":{"name":"#minutes","objective":"dummy"},"color":"yellow"},{"text":":","color":"yellow"},{"score":{"name":"#seconds","objective":"dummy"},"color":"yellow"},{"text":"","color":"yellow', hydration_color:"red", weather_name:"Storm", weather_color:"yellow"}
execute if score #temp_has_water dummy matches 1 if score #temp_has_planks dummy matches 1 if score #temp_processing dummy matches 1 if score #temp_ready dummy matches 0 if score #current weather.state matches 3 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Processing: ","color":"yellow"},{"score":{"name":"#minutes","objective":"dummy"},"color":"yellow"},{"text":":","color":"yellow"},{"score":{"name":"#seconds","objective":"dummy"},"color":"yellow"},{"text":"","color":"yellow', hydration_color:"red", weather_name:"Heavy Storm", weather_color:"gold"}

execute if score #temp_ready dummy matches 1 if score #current weather.state matches 0 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Ready! Click with bottle to collect","color":"green', hydration_color:"red", weather_name:"Clear Skies", weather_color:"aqua"}
execute if score #temp_ready dummy matches 1 if score #current weather.state matches 1 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Ready! Click with bottle to collect","color":"green', hydration_color:"red", weather_name:"Light Breeze", weather_color:"blue"}
execute if score #temp_ready dummy matches 1 if score #current weather.state matches 2 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Ready! Click with bottle to collect","color":"green', hydration_color:"red", weather_name:"Storm", weather_color:"yellow"}
execute if score #temp_ready dummy matches 1 if score #current weather.state matches 3 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Ready! Click with bottle to collect","color":"green', hydration_color:"red", weather_name:"Heavy Storm", weather_color:"gold"}

tag @e[tag=ui_water_purifier] remove ui_water_purifier
tag @e[tag=ui_target_water_purifier] remove ui_target_water_purifier