execute anchored eyes positioned ^ ^ ^ run function mineraft:ui/receiver/start_raycast
execute unless entity @e[tag=ui_target_receiver] run return 0
execute as @e[tag=ui_target_receiver,limit=1] run scoreboard players operation #temp receiver_id = @s receiver_id
execute as @e[type=marker,tag=receiver_active] if score @s receiver_id = #temp receiver_id run tag @s add ui_receiver

execute as @e[type=marker,tag=ui_receiver,limit=1] run scoreboard players operation #temp_battery dummy = @s receiver_has_battery
execute as @e[type=marker,tag=ui_receiver,limit=1] if score @s receiver_has_battery matches 1 run function mineraft:ui/receiver/calculate_countdown

execute if score #temp_battery dummy matches 0 if score #current weather.state matches 0 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Battery: ","color":"gray"},{"text":"0","color":"red"},{"text":"/1 | Needs Battery!","color":"red', hydration_color:"red", weather_name:"Clear Skies", weather_color:"aqua"}
execute if score #temp_battery dummy matches 0 if score #current weather.state matches 1 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Battery: ","color":"gray"},{"text":"0","color":"red"},{"text":"/1 | Needs Battery!","color":"red', hydration_color:"red", weather_name:"Light Breeze", weather_color:"blue"}
execute if score #temp_battery dummy matches 0 if score #current weather.state matches 2 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Battery: ","color":"gray"},{"text":"0","color":"red"},{"text":"/1 | Needs Battery!","color":"red', hydration_color:"red", weather_name:"Storm", weather_color:"yellow"}
execute if score #temp_battery dummy matches 0 if score #current weather.state matches 3 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Battery: ","color":"gray"},{"text":"0","color":"red"},{"text":"/1 | Needs Battery!","color":"red', hydration_color:"red", weather_name:"Heavy Storm", weather_color:"gold"}

execute if score #temp_battery dummy matches 1 if score #current weather.state matches 0 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Battery: ","color":"gray"},{"score":{"name":"#temp_battery","objective":"dummy"},"color":"green"},{"text":"/1 | ","color":"gray"},{"score":{"name":"#minutes","objective":"dummy"},"color":"yellow"},{"text":":","color":"yellow"},{"score":{"name":"#seconds","objective":"dummy"},"color":"yellow"},{"text":" Remaining","color":"yellow', hydration_color:"red", weather_name:"Clear Skies", weather_color:"aqua"}
execute if score #temp_battery dummy matches 1 if score #current weather.state matches 1 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Battery: ","color":"gray"},{"score":{"name":"#temp_battery","objective":"dummy"},"color":"green"},{"text":"/1 | ","color":"gray"},{"score":{"name":"#minutes","objective":"dummy"},"color":"yellow"},{"text":":","color":"yellow"},{"score":{"name":"#seconds","objective":"dummy"},"color":"yellow"},{"text":" Remaining","color":"yellow', hydration_color:"red", weather_name:"Light Breeze", weather_color:"blue"}
execute if score #temp_battery dummy matches 1 if score #current weather.state matches 2 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Battery: ","color":"gray"},{"score":{"name":"#temp_battery","objective":"dummy"},"color":"green"},{"text":"/1 | ","color":"gray"},{"score":{"name":"#minutes","objective":"dummy"},"color":"yellow"},{"text":":","color":"yellow"},{"score":{"name":"#seconds","objective":"dummy"},"color":"yellow"},{"text":" Remaining","color":"yellow', hydration_color:"red", weather_name:"Storm", weather_color:"yellow"}
execute if score #temp_battery dummy matches 1 if score #current weather.state matches 3 run function mineraft:ui/macros/display_actionbar {pot_section:'"},{"text":" | Battery: ","color":"gray"},{"score":{"name":"#temp_battery","objective":"dummy"},"color":"green"},{"text":"/1 | ","color":"gray"},{"score":{"name":"#minutes","objective":"dummy"},"color":"yellow"},{"text":":","color":"yellow"},{"score":{"name":"#seconds","objective":"dummy"},"color":"yellow"},{"text":" Remaining","color":"yellow', hydration_color:"red", weather_name:"Heavy Storm", weather_color:"gold"}

tag @e[tag=ui_receiver] remove ui_receiver
tag @e[tag=ui_target_receiver] remove ui_target_receiver